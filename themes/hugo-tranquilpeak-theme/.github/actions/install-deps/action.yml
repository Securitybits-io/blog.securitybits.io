name: 'Install Dependencies'
description: 'Install npm dependencies'

runs:
  using: "composite"
  steps:
    - name: Install dependencies
      shell: bash
      run: |
        echo "ðŸ“¦ Installing dependencies with npm ci..."
        echo "ðŸ” Debug: Current working directory: $(pwd)"
        echo "ðŸ” Debug: Contents of current directory:"
        ls -la
        
        echo "ðŸ” Debug: Checking package.json and package-lock.json..."
        if [ ! -f "package.json" ]; then
          echo "âŒ package.json not found!"
          exit 1
        fi
        
        if [ ! -f "package-lock.json" ]; then
          echo "âŒ package-lock.json not found!"
          echo "ðŸ” Debug: Creating package-lock.json with npm install..."
          npm install
        fi
        
        echo "ðŸ” Debug: Node.js version: $(node --version)"
        echo "ðŸ” Debug: npm version: $(npm --version)"
        
        echo "ðŸš€ Running npm ci with verbose output..."
        npm ci --include=dev --verbose || {
          echo "âŒ npm ci failed with exit code $?"
          echo "ðŸ” Debug: npm logs:"
          npm config get cache
          ls -la ~/.npm/_logs/ 2>/dev/null || echo "No npm log files found"
          exit 1
        }
        
        echo "âœ… npm ci completed. Verifying node_modules exists..."
        if [ ! -d "node_modules" ]; then
          echo "âŒ node_modules directory was not created!"
          exit 1
        fi
        
        echo "âœ… Dependencies installed. Verifying grunt-cli..."
        if [ -f "node_modules/grunt-cli/bin/grunt" ]; then
          echo "âœ… grunt-cli found at node_modules/grunt-cli/bin/grunt"
        else
          echo "âŒ grunt-cli not found!"
          echo "ðŸ“‹ Contents of node_modules (first 10 entries):"
          ls -la node_modules/ | head -10
          echo "ðŸ“‹ Looking for grunt-cli specifically:"
          find node_modules -name "*grunt*" -type d 2>/dev/null || echo "No grunt directories found"
          exit 1
        fi
        
        echo "ðŸŽ‰ All dependencies installed successfully!" 